package Vista;

import java.awt.EventQueue;
import java.awt.Font;
import java.awt.Image;
import java.awt.Toolkit;
import java.awt.Color;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.SwingConstants;
import javax.swing.JTextField;
import javax.swing.JOptionPane;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.table.DefaultTableModel;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import Controlador.MetodosTeresita;
import Modelo.Conexion;

public class AdminUsuarios {

    private JFrame PLU;
    private JTextField txtNombre;
    private JTextField txtAp;
    private JTextField txtAm;
    private JTextField txtUsername;
    private JTextField txtPassword;
    private JTextField txtId;
    private JTable table;

    public static void main(String[] args) {
        EventQueue.invokeLater(new Runnable() {
            public void run() {
                try {
                    AdminUsuarios window = new AdminUsuarios();
                    window.PLU.setVisible(true);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        });
    }

    public AdminUsuarios() {
        initialize();
    }

    private void initialize() {
        PLU = new JFrame();
        PLU.getContentPane().setBackground(new Color(255, 234, 248));
        PLU.setIconImage(Toolkit.getDefaultToolkit().getImage(AdminUsuarios.class.getResource("/img/08TeresitaLogo.png")));
        PLU.setTitle("ADMIN — USUARIOS");
        PLU.setBounds(100, 100, 940, 720);
        PLU.setLocationRelativeTo(null);
        PLU.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        
        JPanel panel = new JPanel();
        panel.setLayout(null);
        panel.setBackground(new Color(253, 242, 249));
        PLU.getContentPane().add(panel);
        
        JLabel lblTitulo = new JLabel("USUARIOS");
        lblTitulo.setForeground(new Color(128, 128, 128));
        lblTitulo.setHorizontalAlignment(SwingConstants.CENTER);
        lblTitulo.setFont(new Font("Dubai", Font.BOLD, 20));
        lblTitulo.setBounds(405, 20, 200, 50);
        panel.add(lblTitulo);
        
        // Campos de entrada
        JLabel lblId = new JLabel("ID");
        lblId.setBounds(30, 70, 80, 30);
        panel.add(lblId);
        
        txtId = new JTextField();
        txtId.setEnabled(false);
        txtId.setBounds(150, 70, 200, 30);
        panel.add(txtId);
        
        JLabel lblNombre = new JLabel("Nombre");
        lblNombre.setBounds(30, 120, 80, 30);
        panel.add(lblNombre);
        
        txtNombre = new JTextField();
        txtNombre.setBounds(150, 120, 200, 30);
        panel.add(txtNombre);
        
        JLabel lblAp = new JLabel("Apellido Paterno");
        lblAp.setBounds(30, 170, 120, 30);
        panel.add(lblAp);
        
        txtAp = new JTextField();
        txtAp.setBounds(150, 170, 200, 30);
        panel.add(txtAp);
        
        JLabel lblAm = new JLabel("Apellido Materno");
        lblAm.setBounds(30, 220, 120, 30);
        panel.add(lblAm);
        
        txtAm = new JTextField();
        txtAm.setBounds(150, 220, 200, 30);
        panel.add(txtAm);
        
        JLabel lblUsername = new JLabel("Username");
        lblUsername.setBounds(30, 270, 80, 30);
        panel.add(lblUsername);
        
        txtUsername = new JTextField();
        txtUsername.setBounds(150, 270, 200, 30);
        panel.add(txtUsername);
        
        JLabel lblPassword = new JLabel("Password");
        lblPassword.setBounds(30, 320, 80, 30);
        panel.add(lblPassword);
        
        txtPassword = new JTextField();
        txtPassword.setBounds(150, 320, 200, 30);
        panel.add(txtPassword);
        
        // Botones
        JButton btnRegistrar = new JButton("Registrar");
        btnRegistrar.setBounds(400, 70, 120, 30);
        panel.add(btnRegistrar);
        
        JButton btnEditar = new JButton("Editar");
        btnEditar.setBounds(400, 120, 120, 30);
        panel.add(btnEditar);
        
        JButton btnEliminar = new JButton("Eliminar");
        btnEliminar.setBounds(400, 170, 120, 30);
        panel.add(btnEliminar);
        
        JButton btnCargar = new JButton("Cargar");
        btnCargar.setBounds(400, 220, 120, 30);
        panel.add(btnCargar);
        
        // Tabla para mostrar usuarios
        JScrollPane scrollPane = new JScrollPane();
        scrollPane.setBounds(30, 380, 860, 250);
        panel.add(scrollPane);
        
        table = new JTable();
        scrollPane.setViewportView(table);
        
        // Acciones de los botones
        btnRegistrar.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                MetodosTeresita mt = new MetodosTeresita();
                mt.setNombre(txtNombre.getText());
                mt.setAp(txtAp.getText());
                mt.setAm(txtAm.getText());
                mt.setUsername(txtUsername.getText());
                mt.setPassword(txtPassword.getText());
                
                if (mt.insertarUsuario()) {
                    JOptionPane.showMessageDialog(null, "¡Usuario registrado exitosamente!");
                } else {
                    JOptionPane.showMessageDialog(null, "¡Error al registrar el usuario!");
                }
            }
        });
        
        btnEditar.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                MetodosTeresita mt = new MetodosTeresita();
                mt.setId(Integer.parseInt(txtId.getText()));
                mt.setNombre(txtNombre.getText());
                mt.setAp(txtAp.getText());
                mt.setAm(txtAm.getText());
                mt.setUsername(txtUsername.getText());
                mt.setPassword(txtPassword.getText());
                
                if (mt.actualizarUsuario()) {
                    JOptionPane.showMessageDialog(null, "¡Usuario actualizado exitosamente!");
                } else {
                    JOptionPane.showMessageDialog(null, "¡Error al actualizar el usuario!");
                }
            }
        });
        
        btnEliminar.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                int fila = table.getSelectedRow();
                if (fila != -1) {
                    String id = table.getValueAt(fila, 0).toString();
                    MetodosTeresita mt = new MetodosTeresita();
                    mt.setId(Integer.parseInt(id));
                    
                    if (mt.eliminarUsuario()) {
                        JOptionPane.showMessageDialog(null, "¡Usuario eliminado!");
                    } else {
                        JOptionPane.showMessageDialog(null, "¡Error al eliminar el usuario!");
                    }
                } else {
                    JOptionPane.showMessageDialog(null, "¡Seleccione un usuario para eliminar!");
                }
            }
        });
        
        btnCargar.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                cargarUsuarios();
            }
        });
    }

    private void cargarUsuarios() {
        DefaultTableModel modelo = new DefaultTableModel();
        modelo.addColumn("ID");
        modelo.addColumn("Nombre");
        modelo.addColumn("Apellido Paterno");
        modelo.addColumn("Apellido Materno");
        modelo.addColumn("Username");
        
        try {
            Connection conn = new Conexion().conectar();
            PreparedStatement ps = conn.prepareStatement("SELECT id_u, nombre, ap, am, username FROM usuario");
            ResultSet rs = ps.executeQuery();
            while (rs.next()) {
                modelo.addRow(new Object[]{
                    rs.getInt("id_u"),
                    rs.getString("nombre"),
                    rs.getString("ap"),
                    rs.getString("am"),
                    rs.getString("username")
                });
            }
            table.setModel(modelo);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}
